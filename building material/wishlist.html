<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wishlist - Building Materials</title>
    <style>
        /* Keep only keyframes needed for spinner animation; all other rules moved inline */
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
    <link rel="stylesheet" href="style.css">
</head>
<body style="margin:0;padding:20px;box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background:linear-gradient(135deg,#f5f7fa 0%, #c3cfe2 100%);min-height:100vh;">
    <div style="width:100%;margin:0 auto;">

  <div id="navbar-container"></div>


<!-- 
        <div id="localNavbar" style="background:white;padding:15px 25px;border-radius:12px;margin-bottom:30px;box-shadow:0 4px 15px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center;flex-wrap:nowrap;">
            <div style="font-size:20px;font-weight:bold;color:#2c3e50;">‚ù§Ô∏è My Wishlist</div>
            <div id="localNavLinks" style="display:flex;gap:15px;">
                <a href="view_products.html" class="localNavBtn" style="padding:10px 20px;background:linear-gradient(135deg,#3498db 0%,#2980b9 100%);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:bold;transition:all .3s;text-decoration:none;display:inline-block;">üèóÔ∏è View All Products</a>
            </div>
        </div> -->

      <div class="navbanners"   style="
  background:url('images/wishlist.png') center/cover no-repeat;
 
">
  <div style="
    display:inline-block;
    background:rgba(192,57,43,0.85);
    padding:20px 30px;
    border-radius:10px;
  ">
    <h1 style="font-size:36px;margin-bottom:10px;color:#fff;">
      ‚ù§Ô∏è My Wishlist
    </h1>
    <p style="color:#fdecea;margin:0;">
      Your saved favorite building materials
    </p>
  </div>
</div>

        <div id="successMsg" style="display:none;background:#d4edda;color:#155724;padding:15px;border-radius:6px;margin-bottom:20px;"></div>
        <div id="errorMsg" style="display:none;background:#f8d7da;color:#721c24;padding:15px;border-radius:6px;margin-bottom:20px;"></div>

        <div style="background:white;padding:20px 25px;border-radius:8px;margin-bottom:30px;box-shadow:0 2px 10px rgba(0,0,0,0.08);display:grid;grid-template-columns:repeat(2,1fr);gap:20px;" id="wishlistStats">
            <div style="text-align:center;">
                <span id="totalWishlist" style="font-size:28px;font-weight:bold;color:#e74c3c;display:block;margin-bottom:5px;">0</span>
                <div style="font-size:13px;color:#666;font-weight:600;">Items in Wishlist</div>
            </div>
            <div style="text-align:center;">
                <span id="totalValue" style="font-size:28px;font-weight:bold;color:#e74c3c;display:block;margin-bottom:5px;">‚Çπ0</span>
                <div style="font-size:13px;color:#666;font-weight:600;">Total Value</div>
            </div>
        </div>

        <div id="actionButtons" style="display:none;gap:10px;margin-bottom:30px;flex-wrap:wrap;" role="group">
            <button id="actionContinue" onclick="continueShoppingRedirect()" style="padding:12px 25px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;transition:all .3s;font-size:14px;background:linear-gradient(135deg,#27ae60 0%,#229954 100%);color:white;">üõçÔ∏è Continue Shopping</button>
            <button id="actionClear" onclick="clearWishlist()" style="padding:12px 25px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;transition:all .3s;font-size:14px;background:#95a5a6;color:white;">üóëÔ∏è Clear Wishlist</button>
        </div>

        <div id="loadingContainer" style="display:none;text-align:center;padding:40px;font-size:18px;color:#7f8c8d;">
            <div style="border:4px solid #f3f3f3;border-top:4px solid #e74c3c;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:20px auto;"></div>
            <div>Loading wishlist...</div>
        </div>

        <div id="wishlistContainer" class="products-grid"></div>
    </div>

    <!-- Product Details Modal -->
    <div id="productModal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.7);">
        <div style="background-color:#fff;margin:5% auto;padding:30px;border-radius:12px;max-width:600px;box-shadow:0 8px 30px rgba(0,0,0,0.3);max-height:80vh;overflow-y:auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;border-bottom:2px solid #eee;padding-bottom:15px;">
                <h2 style="color:#2c3e50;">Product Details</h2>
                <span style="color:#aaa;font-size:28px;font-weight:bold;cursor:pointer;transition:color .3s;" onclick="closeModal()">&times;</span>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>




<div id="footer-placeholder"></div>

<script>
fetch('footer.html')
  .then(response => response.text())
  .then(data => {
    document.getElementById('footer-placeholder').innerHTML = data;
  })
  .catch(error => console.error('Footer load error:', error));
</script>


    <script>
        let wishlist = JSON.parse(localStorage.getItem('productWishlist')) || [];
        let wishlistProducts = [];

        // Load wishlist on page load
        window.addEventListener('load', loadWishlist);

        async function loadWishlist() {
            const container = document.getElementById('wishlistContainer');
            const loadingContainer = document.getElementById('loadingContainer');
            const actionButtons = document.getElementById('actionButtons');

            loadingContainer.style.display = 'block';
            container.innerHTML = '';

            if (wishlist.length === 0) {
                loadingContainer.style.display = 'none';
                actionButtons.style.display = 'none';
                container.innerHTML = `
                    <div style="grid-column:1/-1;text-align:center;padding:80px 20px;background:white;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                        <div style="font-size:80px;margin-bottom:20px;">üõçÔ∏è</div>
                        <div style="font-size:20px;color:#7f8c8d;margin-bottom:15px;font-weight:bold;">Your wishlist is empty</div>
                        <div style="color:#95a5a6;margin-bottom:30px;">Start adding your favorite building materials!</div>
                        <a href="view_products.html" style="padding:12px 30px;background:linear-gradient(135deg,#3498db 0%,#2980b9 100%);color:white;border:none;border-radius:6px;text-decoration:none;">Browse Products</a>
                    </div>
                `;
                // make sure new inline behaviors apply to dynamically created content
                if (typeof setupInlineInteractions === 'function') setupInlineInteractions();
                updateStats();
                return;
            }

            try {
                // Fetch all products and filter by wishlist IDs
                const response = await fetch('http://localhost:5000/api/product_uploads?limit=1000');
                const data = await response.json();

                if (!data.success || !data.products) {
                    throw new Error(data.error || 'Failed to fetch products');
                }

                // Filter products that are in wishlist
                wishlistProducts = data.products.filter(p => wishlist.includes(p.id));

                displayWishlist(wishlistProducts);
                updateStats();
                loadingContainer.style.display = 'none';
                actionButtons.style.display = 'flex';

            } catch (error) {
                loadingContainer.style.display = 'none';
                container.innerHTML = `
                    <div style="grid-column:1/-1;text-align:center;padding:80px 20px;background:white;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                        <div style="font-size:80px;margin-bottom:20px;">‚ùå</div>
                        <div style="font-size:20px;color:#7f8c8d;margin-bottom:15px;font-weight:bold;">Error loading wishlist</div>
                        <div style="color:#95a5a6;margin-bottom:30px;">${error.message}</div>
                    </div>
                `;
            }
        }

        function displayWishlist(products) {
            const container = document.getElementById('wishlistContainer');

            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div style="grid-column:1/-1;text-align:center;padding:80px 20px;background:white;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                        <div style="font-size:80px;margin-bottom:20px;">üõçÔ∏è</div>
                        <div style="font-size:20px;color:#7f8c8d;margin-bottom:15px;font-weight:bold;">Your wishlist is empty</div>
                        <div style="color:#95a5a6;margin-bottom:30px;">Start adding your favorite building materials!</div>
                        <a href="view_products.html" style="padding:12px 30px;background:linear-gradient(135deg,#3498db 0%,#2980b9 100%);color:white;border:none;border-radius:6px;text-decoration:none;">Browse Products</a>
                    </div>
                `;
                if (typeof setupInlineInteractions === 'function') setupInlineInteractions();
                return;
            }

            container.innerHTML = products.map(product => `
                <div style="background:white;border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.1);transition:all 0.3s ease;display:flex;flex-direction:column;position:relative;" class="product-card-inline">
                    <div style="position:absolute;top:10px;right:10px;background:#e74c3c;color:white;padding:8px 12px;border-radius:6px;font-weight:bold;font-size:12px;z-index:10;">‚ù§Ô∏è In Wishlist</div>
                    <div style="width:100%;height:200px;background:#f5f5f5;display:flex;align-items:center;justify-content:center;overflow:hidden;border-bottom:3px solid #e74c3c;">
                        ${product.imageUrl ? 
                            `<img src="${product.imageUrl}" alt="${product.productName}" onerror="this.style.display='none'" style="width:100%;height:100%;object-fit:cover;">` :
                            `<div style="font-size:48px;color:#ddd;">üì¶</div>`
                        }
                    </div>
                    <div style="padding:20px;flex-grow:1;display:flex;flex-direction:column;">
                        <div style="display:inline-block;background:#f5e6e6;color:#e74c3c;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:bold;margin-bottom:10px;width:fit-content;">${getCategoryLabel(product.category)}</div>
                        <div style="font-size:16px;font-weight:bold;color:#2c3e50;margin-bottom:8px;line-height:1.4;">${product.productName}</div>
                        ${product.brand ? `<div style="font-size:12px;color:#7f8c8d;margin-bottom:10px;">Brand: ${product.brand}</div>` : ''}
                        ${product.description ? `<div style="font-size:13px;color:#555;line-height:1.4;margin-bottom:15px;flex-grow:1;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;">${product.description}</div>` : ''}
                        
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid #eee;">
                            <div>
                                ${product.discount > 0 ? `<div style="text-decoration:line-through;color:#95a5a6;font-size:13px;">‚Çπ${parseFloat(product.price).toFixed(2)}</div>` : ''}
                                <div style="font-size:22px;font-weight:bold;color:#27ae60;">‚Çπ${parseFloat(product.finalPrice || product.price).toFixed(2)}</div>
                            </div>
                            ${product.discount > 0 ? `<div style="background:#e74c3c;color:white;padding:4px 10px;border-radius:4px;font-size:12px;font-weight:bold;">${product.discount}% OFF</div>` : ''}
                        </div>

                        ${product.rating ? `
                            <div style="display:flex;align-items:center;gap:5px;margin-bottom:10px;">
                                <span style="color:#f39c12;font-size:14px;">${getStars(product.rating)}</span>
                                <span style="color:#666;font-size:12px;">(${product.rating}/5)</span>
                            </div>
                        ` : ''}

                        <div style="font-size:12px;color:#666;line-height:1.6;margin-bottom:12px;">
                            <div style="display:flex;justify-content:space-between;margin-bottom:5px;"><span>Qty:</span><span>${product.quantity} ${product.quantityUnit || 'piece'}</span></div>
                            ${product.moq ? `
                                <div style="display:flex;justify-content:space-between;margin-bottom:5px;"><span>MOQ:</span><span>${product.moq}</span></div>
                            ` : ''}
                        </div>

                        <div style="display:flex;gap:10px;">
                            <button onclick="viewProductDetails(${product.id})" style="flex:1;padding:10px;background:linear-gradient(135deg,#3498db 0%,#2980b9 100%);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:13px;transition:all .3s;">üëÅÔ∏è View</button>
                            <button onclick="removeFromWishlist(${product.id}, '${product.productName}')" style="flex:1;padding:10px;background:#e74c3c;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:13px;transition:all .3s;">‚ùå Remove</button>
                        </div>
                    </div>
                </div>
            `).join('');
            // After injecting, setup hover and responsive behaviors for new inline elements
            if (typeof setupInlineInteractions === 'function') setupInlineInteractions();
        }

        function getCategoryLabel(category) {
            const labels = {
                'cement': 'üè≠ Cement',
                'bricks': 'üß± Bricks',
                'building-materials': 'üèóÔ∏è Building Materials',
                'iron-steel': '‚öôÔ∏è Iron & Steel',
                'plumbing': 'üö∞ Plumbing',
                'home-interior': 'üé® Home Interior'
            };
            return labels[category] || category;
        }

        function getStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalf = rating % 1 !== 0;
            let stars = '‚òÖ'.repeat(fullStars);
            if (hasHalf) stars += '¬Ω';
            stars += '‚òÜ'.repeat(5 - Math.ceil(rating));
            return stars;
        }

        async function viewProductDetails(productId) {
            try {
                const response = await fetch(`http://localhost:5000/api/product_uploads/${productId}`);
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error);
                }

                const product = data.product;
                const modal = document.getElementById('productModal');
                const modalBody = document.getElementById('modalBody');

                let detailsHTML = '';

                if (product.imageUrl) {
                    detailsHTML += `<img src="${product.imageUrl}" alt="${product.productName}" class="modal-image" onerror="this.style.display='none'">`;
                }

                detailsHTML += `
                    <div class="modal-details">
                        <div class="detail-group">
                            <div class="detail-item">
                                <div class="detail-label">Product Name</div>
                                <div class="detail-value">${product.productName}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Category</div>
                                <div class="detail-value">${getCategoryLabel(product.category)}</div>
                            </div>
                        </div>

                        <div class="detail-group">
                            <div class="detail-item">
                                <div class="detail-label">Price</div>
                                <div class="detail-value">‚Çπ${parseFloat(product.price).toFixed(2)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Final Price</div>
                                <div class="detail-value">‚Çπ${parseFloat(product.finalPrice || product.price).toFixed(2)}</div>
                            </div>
                        </div>

                        ${product.discount ? `
                            <div class="detail-group">
                                <div class="detail-item">
                                    <div class="detail-label">Discount</div>
                                    <div class="detail-value">${product.discount}%</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Brand</div>
                                    <div class="detail-value">${product.brand || 'N/A'}</div>
                                </div>
                            </div>
                        ` : ''}

                        ${product.description ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">Description</div>
                                <div class="detail-value">${product.description}</div>
                            </div>
                        ` : ''}

                        <div class="detail-group">
                            <div class="detail-item">
                                <div class="detail-label">Quantity</div>
                                <div class="detail-value">${product.quantity} ${product.quantityUnit || 'piece'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Rating</div>
                                <div class="detail-value">${product.rating ? product.rating + '/5' : 'N/A'}</div>
                            </div>
                        </div>

                        <div class="detail-group">
                            <div class="detail-item">
                                <div class="detail-label">MOQ</div>
                                <div class="detail-value">${product.moq || 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Warranty</div>
                                <div class="detail-value">${product.warranty ? product.warranty + ' months' : 'N/A'}</div>
                            </div>
                        </div>

                        ${product.color ? `
                            <div class="detail-group">
                                <div class="detail-item">
                                    <div class="detail-label">Color</div>
                                    <div class="detail-value">${product.color}</div>
                                </div>
                            </div>
                        ` : ''}

                        <div class="detail-item" style="grid-column: 1 / -1;">
                            <div class="detail-label">Created</div>
                            <div class="detail-value">${new Date(product.created_at).toLocaleString()}</div>
                        </div>
                    </div>
                `;

                modalBody.innerHTML = detailsHTML;
                modal.style.display = 'block';

            } catch (error) {
                showError('Failed to load product details: ' + error.message);
            }
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function removeFromWishlist(productId, productName) {
            const index = wishlist.indexOf(productId);
            
            if (index > -1) {
                wishlist.splice(index, 1);
                localStorage.setItem('productWishlist', JSON.stringify(wishlist));
                showSuccess(`${productName} removed from wishlist!`);
                loadWishlist();
            }
        }

        function clearWishlist() {
            if (confirm('Are you sure you want to clear your entire wishlist?')) {
                wishlist = [];
                localStorage.setItem('productWishlist', JSON.stringify(wishlist));
                showSuccess('Wishlist cleared!');
                loadWishlist();
            }
        }

        function continueShoppingRedirect() {
            window.location.href = 'view_products.html';
        }

        function updateStats() {
            document.getElementById('totalWishlist').textContent = wishlistProducts.length;
            
            const totalValue = wishlistProducts.reduce((sum, product) => {
                return sum + parseFloat(product.finalPrice || product.price);
            }, 0);
            
            document.getElementById('totalValue').textContent = '‚Çπ' + totalValue.toFixed(2);
        }

        function showSuccess(message) {
            const msgDiv = document.getElementById('successMsg');
            msgDiv.textContent = '‚úÖ ' + message;
            msgDiv.style.display = 'block';
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, 3000);
        }

        function showError(message) {
            const msgDiv = document.getElementById('errorMsg');
            msgDiv.textContent = '‚ùå ' + message;
            msgDiv.style.display = 'block';
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, 3000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('productModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // --- Inline interaction helpers (hover emulation and responsive handling) ---
        function addHover(el, hoverStyles) {
            if (!el) return;
            if (el.__origStyle === undefined) el.__origStyle = el.getAttribute('style') || '';
            const apply = () => el.setAttribute('style', el.__origStyle + hoverStyles);
            const remove = () => el.setAttribute('style', el.__origStyle);
            el.addEventListener('mouseenter', apply);
            el.addEventListener('mouseleave', remove);
        }

        function setupInlineInteractions() {
            // navbar buttons
            document.querySelectorAll('.localNavBtn').forEach(btn => {
                addHover(btn, 'background:linear-gradient(135deg,#2980b9 0%,#1f618d 100%);transform:translateY(-2px);box-shadow:0 5px 15px rgba(52,152,219,0.3);');
            });

            // action buttons
            const cont = document.getElementById('actionContinue');
            if (cont) addHover(cont, 'background:linear-gradient(135deg,#229954 0%,#1e8449 100%);transform:translateY(-2px);');
            const clear = document.getElementById('actionClear');
            if (clear) addHover(clear, 'background:#7f8c8d;transform:translateY(-2px);');

            // product card hover
            document.querySelectorAll('.product-card-inline').forEach(card => {
                if (card.__origStyle === undefined) card.__origStyle = card.getAttribute('style') || '';
                card.addEventListener('mouseenter', () => card.setAttribute('style', card.__origStyle + 'transform:translateY(-8px);box-shadow:0 12px 30px rgba(0,0,0,0.15);'));
                card.addEventListener('mouseleave', () => card.setAttribute('style', card.__origStyle));
            });

            // product buttons hover
            document.querySelectorAll('.product-card-inline button').forEach(btn => {
                if (btn.__origStyle === undefined) btn.__origStyle = btn.getAttribute('style') || '';
                btn.addEventListener('mouseenter', () => btn.setAttribute('style', btn.__origStyle + 'transform:translateY(-2px);'));
                btn.addEventListener('mouseleave', () => btn.setAttribute('style', btn.__origStyle));
            });

            handleResponsive();
        }

        function handleResponsive() {
            const isMobile = window.matchMedia('(max-width:768px)').matches;
            const stats = document.getElementById('wishlistStats');
            if (stats) stats.style.gridTemplateColumns = isMobile ? '1fr 1fr' : 'repeat(2,1fr)';
            const productGrid = document.getElementById('wishlistContainer');
            if (productGrid) {
                productGrid.style.display = 'grid';
                productGrid.style.gridTemplateColumns = isMobile ? 'repeat(auto-fill,minmax(200px,1fr))' : 'repeat(auto-fill,minmax(280px,1fr))';
                productGrid.style.gap = '25px';
                productGrid.style.marginBottom = '30px';
            }
            const localNav = document.getElementById('localNavbar');
            if (localNav) localNav.style.flexDirection = isMobile ? 'column' : 'row';
            const navLinks = document.getElementById('localNavLinks');
            if (navLinks) navLinks.style.width = isMobile ? '100%' : 'auto';
        }

        window.addEventListener('resize', handleResponsive);
        window.addEventListener('DOMContentLoaded', () => {
            setupInlineInteractions();
            handleResponsive();
        });

        // Ensure interactions apply after dynamic content updates
        if (typeof setupInlineInteractions === 'function') setupInlineInteractions();
    </script>




  <!-- Load Navbar Script -->
  <script>
  // Load shared navbar (injects navbar.html body and executes its scripts)
  async function includeNavbar() {
    try {
      const res = await fetch('navbar.html');
      const text = await res.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');
      document.getElementById('navbar-container').innerHTML = doc.body.innerHTML;

      // Execute scripts from navbar.html and wait for external scripts to load
      const __createdScriptPromises = [];
      doc.querySelectorAll('script').forEach(s => {
        const newScript = document.createElement('script');
        if (s.src) {
          newScript.src = s.src;
          newScript.async = false;
          __createdScriptPromises.push(new Promise(resolve => {
            newScript.addEventListener('load', resolve);
            newScript.addEventListener('error', resolve);
            setTimeout(resolve, 2000);
          }));
        } else {
          newScript.textContent = s.textContent;
        }
        document.body.appendChild(newScript);
      });
      Promise.all(__createdScriptPromises).finally(() => {});

      // Ensure navbar init functions run after dynamic injection (wait for external scripts to load)
      const __navbarScriptPromises = [];
      doc.querySelectorAll('script').forEach((s, i) => {
        const existing = document.querySelectorAll('script')[document.querySelectorAll('script').length - 1 - i];
        if (existing && existing.src) {
          __navbarScriptPromises.push(new Promise(resolve => {
            existing.addEventListener('load', resolve);
            existing.addEventListener('error', resolve);
            setTimeout(resolve, 2000);
          }));
        }
      });
      Promise.all(__navbarScriptPromises).finally(() => {
        if (typeof checkScreenSize === 'function') checkScreenSize();
        if (typeof addDesktopHoverEffects === 'function') addDesktopHoverEffects();
        if (typeof updateUserUI === 'function') updateUserUI();
        if (typeof updateCartBadge === 'function') updateCartBadge();
        if (typeof setActiveNavLink === 'function') setActiveNavLink();
      });
    } catch (e) {
      console.error('Failed to load navbar:', e);
    }
  }
  includeNavbar();
</script>


</body>
</html>
