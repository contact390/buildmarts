<!DOCTYPE html>
<html>
<head>
  <title>User Messages</title>
</head>
<body style="font-family:Arial,sans-serif;margin:0;padding:0;background:#f8f9fa;">

  <div style="max-width:1000px;margin:40px auto;padding:20px;background:#fff;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
    <h2 style="text-align:center;margin-bottom:20px;color:#333;">Check Your Submitted Messages</h2>

    <div style="margin-bottom:20px;text-align:center;">
      <input type="email" id="emailInput" placeholder="Enter your email" style="padding:10px;width:300px;border:1px solid #ccc;border-radius:5px;">
      <button onclick="loadMessages()" style="padding:10px 20px;background:#007BFF;color:#fff;border:none;border-radius:5px;cursor:pointer;">View Messages</button>
    </div>

    <table style="width:100%;border-collapse:collapse;">
      <thead>
        <tr style="background-color:#007BFF;color:#fff;">
          <th style="padding:12px;border:1px solid #ddd;">ID</th>
          <th style="padding:12px;border:1px solid #ddd;">Name</th>
          <th style="padding:12px;border:1px solid #ddd;">Email</th>
          <th style="padding:12px;border:1px solid #ddd;">Subject</th>
          <th style="padding:12px;border:1px solid #ddd;">Message</th>
          <th style="padding:12px;border:1px solid #ddd;">Date</th>
        </tr>
      </thead>
      <tbody id="messagesTable">
        <!-- Messages will appear here -->
      </tbody>
    </table>
  </div>

  <script>
    function loadMessages() {
      const email = document.getElementById('emailInput').value.trim();
      const table = document.getElementById('messagesTable');
      table.innerHTML = '';

      if (!email) {
        table.innerHTML = `<tr><td colspan="6" style="padding:15px;text-align:center;color:red;">Please enter a valid email.</td></tr>`;
        return;
      }

      fetch(`http://localhost:5000/api/contact_us/${encodeURIComponent(email)}`)
        .then(res => res.json())
        .then(data => {
          if (!Array.isArray(data) || data.length === 0) {
            table.innerHTML = `<tr><td colspan="6" style="padding:15px;text-align:center;">No messages found for <b>${email}</b>.</td></tr>`;
          } else {
            data.forEach(msg => {
              const row = `
                <tr>
                  <td style="padding:10px;border:1px solid #ddd;">${msg.id}</td>
                  <td style="padding:10px;border:1px solid #ddd;">${msg.name}</td>
                  <td style="padding:10px;border:1px solid #ddd;">${msg.email}</td>
                  <td style="padding:10px;border:1px solid #ddd;">${msg.subject}</td>
                  <td style="padding:10px;border:1px solid #ddd;">${msg.message}</td>
                  <td style="padding:10px;border:1px solid #ddd;">${new Date(msg.created_at).toLocaleString()}</td>
                </tr>
              `;
              table.innerHTML += row;
            });
          }
        })
        .catch(error => {
          console.error('Error fetching messages:', error);
          table.innerHTML = `<tr><td colspan="6" style="padding:15px;text-align:center;color:red;">Error fetching messages. Please try again later.</td></tr>`;
        });
    }
  </script>

<!--bm_plan check-->

 <div style="max-width: 600px; margin: auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
    <h2 style="text-align:center;">Find Your Plan Submissions</h2>

    <input type="email" id="emailInput" placeholder="Enter your email"
      style="width:100%; padding:10px; margin: 20px 0; border:1px solid #ccc; border-radius:5px;" required>

    <button onclick="getPlans()"
      style="width:100%; padding:10px; background:#28a745; color:#fff; border:none; border-radius:5px; cursor:pointer;">
      Get My Plans
    </button>

    <div id="output" style="margin-top: 25px;"></div>
  </div>

  <script>
    function getPlans() {
      const email = document.getElementById('emailInput').value.trim();
      const output = document.getElementById('output');
      output.innerHTML = '';

      if (!email) {
        output.innerHTML = "<p style='color:red;'>Please enter a valid email.</p>";
        return;
      }





      fetch(`http://localhost:5000/api/bm_plans/${encodeURIComponent(email)}`)
        .then(res => {
          if (!res.ok) throw new Error("No data found for this email.");
          return res.json();
        })
        .then(plans => {
          let html = `<h3>Plans for ${email}</h3>`;
          plans.forEach((plan, index) => {
            html += `
              <div style="padding:10px; margin:10px 0; background:#f1f1f1; border-radius:6px;">
                <p><strong>#${index + 1}</strong></p>
                <p><strong>Full Name:</strong> ${plan.fullName}</p>
                <p><strong>Email:</strong> ${plan.email}</p>
                <p><strong>Phone:</strong> ${plan.phone}</p>
                <p><strong>Company:</strong> ${plan.company || 'N/A'}</p>
                <p><strong>Plan:</strong> ${plan.plan}</p>
                <p><strong>Price:</strong> ${plan.price}</p>
                <p><strong>Submitted At:</strong> ${new Date(plan.submitted_at).toLocaleString()}</p>
              </div>
            `;
          });
          output.innerHTML = html;
        })
        .catch(err => {
          output.innerHTML = `<p style="color:red;">${err.message}</p>`;
        });
    }
  </script>
</body>
</html>
